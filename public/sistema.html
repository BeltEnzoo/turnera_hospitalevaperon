<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Sistemas - Turnera</title>
    <link rel="stylesheet" href="/css/sistema.css">
</head>
<body>
    <div class="app" id="app">
        <!-- Login -->
        <div id="login-section" class="login-container">
            <div class="login-box">
                <h1>‚öôÔ∏è Panel de Sistemas</h1>
                <form id="login-form">
                    <div class="form-group">
                        <label>Usuario</label>
                        <input type="text" id="username" required>
                    </div>
                    <div class="form-group">
                        <label>Contrase√±a</label>
                        <input type="password" id="password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Iniciar Sesi√≥n</button>
                    <div id="login-error" class="error-message"></div>
                </form>
            </div>
        </div>

        <!-- Dashboard Sistema -->
        <div id="dashboard-section" style="display: none;">
            <nav class="navbar">
                <div class="navbar-brand">
                    <h2>‚öôÔ∏è Panel de Sistemas</h2>
                </div>
                <div class="navbar-user">
                    <span id="user-name"></span>
                    <button onclick="logout()" class="btn btn-sm">Salir</button>
                </div>
            </nav>

            <div class="container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="showTab('medicos')">üë®‚Äç‚öïÔ∏è M√©dicos</button>
                    <button class="tab-btn" onclick="showTab('turnos')">üìã Turnos</button>
                    <button class="tab-btn" onclick="showTab('database')">üóÑÔ∏è Base de Datos</button>
                    <button class="tab-btn" onclick="showTab('config')">‚öôÔ∏è Configuraci√≥n</button>
                    <button class="tab-btn" onclick="showTab('reportes')">üìä Reportes</button>
                </div>

                <!-- Tab: Gesti√≥n de M√©dicos -->
                <div id="tab-medicos" class="tab-content active">
                    <div class="section-header">
                        <h3>üë®‚Äç‚öïÔ∏è Gesti√≥n de M√©dicos</h3>
                        <button class="btn btn-success" onclick="mostrarFormularioMedico()">‚ûï Nuevo M√©dico</button>
                    </div>
                    
                    <div class="table-container">
                        <table id="medicos-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Usuario</th>
                                    <th>Nombre Completo</th>
                                    <th>Consultorio</th>
                                    <th>Especialidad</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="medicos-tbody">
                                <tr>
                                    <td colspan="7" class="text-center">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Base de Datos -->
                <div id="tab-database" class="tab-content">
                    <div class="section-header">
                        <h3>üóÑÔ∏è Vista de Base de Datos</h3>
                        <div class="action-buttons">
                            <button class="btn btn-success" onclick="actualizarBaseDatos()">üîÑ Actualizar</button>
                            <button class="btn btn-warning" onclick="toggleAutoRefresh()">
                                <span id="auto-refresh-text">‚ñ∂Ô∏è Auto-actualizaci√≥n</span>
                            </button>
                        </div>
                    </div>
                    
                    <div class="database-tabs">
                        <button class="db-tab-btn active" onclick="showDbTab('usuarios')">üë• Usuarios</button>
                        <button class="db-tab-btn" onclick="showDbTab('turnos')">üìã Turnos</button>
                        <button class="db-tab-btn" onclick="showDbTab('historial')">üìú Historial</button>
                        <button class="db-tab-btn" onclick="showDbTab('estadisticas')">üìä Estad√≠sticas</button>
                    </div>

                    <!-- Tab: Usuarios -->
                    <div id="db-usuarios" class="db-tab-content active">
                        <h4>üë• Tabla: usuarios</h4>
                        <div class="table-container">
                            <table id="db-usuarios-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Username</th>
                                        <th>Nombre Completo</th>
                                        <th>Rol</th>
                                        <th>Consultorio</th>
                                        <th>Especialidad</th>
                                        <th>Activo</th>
                                        <th>Created At</th>
                                    </tr>
                                </thead>
                                <tbody id="db-usuarios-tbody">
                                    <tr><td colspan="8" class="text-center">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tab: Turnos -->
                    <div id="db-turnos" class="db-tab-content">
                        <h4>üìã Tabla: turnos</h4>
                        <div class="db-filters">
                            <input type="date" id="db-fecha-turnos" class="form-control">
                            <select id="db-estado-turnos" class="form-control">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="llamado">Llamado</option>
                                <option value="atendido">Atendido</option>
                                <option value="ausente">Ausente</option>
                            </select>
                            <button class="btn btn-primary" onclick="filtrarDbTurnos()">Filtrar</button>
                        </div>
                        <div class="table-container">
                            <table id="db-turnos-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>N¬∞ Turno</th>
                                        <th>Paciente</th>
                                        <th>DNI</th>
                                        <th>M√©dico ID</th>
                                        <th>Consultorio</th>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Estado</th>
                                        <th>Llamado At</th>
                                        <th>Atendido At</th>
                                    </tr>
                                </thead>
                                <tbody id="db-turnos-tbody">
                                    <tr><td colspan="11" class="text-center">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tab: Historial -->
                    <div id="db-historial" class="db-tab-content">
                        <h4>üìú Tabla: historial_llamados</h4>
                        <div class="table-container">
                            <table id="db-historial-table">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Turno ID</th>
                                        <th>M√©dico ID</th>
                                        <th>Paciente</th>
                                        <th>Consultorio</th>
                                        <th>Llamado At</th>
                                    </tr>
                                </thead>
                                <tbody id="db-historial-tbody">
                                    <tr><td colspan="6" class="text-center">Cargando...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Tab: Estad√≠sticas -->
                    <div id="db-estadisticas" class="db-tab-content">
                        <h4>üìä Estad√≠sticas de Base de Datos</h4>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-icon">üë•</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="db-total-usuarios">0</div>
                                    <div class="stat-label">Total Usuarios</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üë®‚Äç‚öïÔ∏è</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="db-total-medicos">0</div>
                                    <div class="stat-label">M√©dicos</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìã</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="db-total-turnos">0</div>
                                    <div class="stat-label">Total Turnos</div>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon">üìú</div>
                                <div class="stat-content">
                                    <div class="stat-value" id="db-total-historial">0</div>
                                    <div class="stat-label">Llamados Realizados</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="db-actions">
                            <button class="btn btn-danger" onclick="limpiarBaseDatos()">üßπ Limpiar Base de Datos</button>
                            <button class="btn btn-warning" onclick="exportarBaseDatos()">üíæ Exportar BD</button>
                            <button class="btn btn-info" onclick="optimizarBaseDatos()">‚ö° Optimizar BD</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Gesti√≥n de Turnos -->
                <div id="tab-turnos" class="tab-content">
                    <div class="section-header">
                        <h3>üìã Gesti√≥n de Turnos</h3>
                        <div class="action-buttons">
                            <input type="date" id="filter-fecha-turnos" class="form-control">
                            <button class="btn btn-primary" onclick="cargarTurnos()">Filtrar</button>
                            <button class="btn btn-danger" onclick="limpiarTurnos()">üßπ Limpiar Turnos</button>
                        </div>
                    </div>
                    
                    <div class="table-container">
                        <table id="turnos-table">
                            <thead>
                                <tr>
                                    <th>N¬∞ Turno</th>
                                    <th>Paciente</th>
                                    <th>DNI</th>
                                    <th>M√©dico</th>
                                    <th>Consultorio</th>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="turnos-tbody">
                                <tr>
                                    <td colspan="9" class="text-center">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Tab: Configuraci√≥n -->
                <div id="tab-config" class="tab-content">
                    <h3>‚öôÔ∏è Configuraci√≥n del Sistema</h3>
                    
                    <div class="config-sections">
                        <div class="config-section">
                            <h4>üîä Configuraci√≥n de Audio</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Velocidad de voz</label>
                                    <select id="audio-rate" class="form-control">
                                        <option value="0.5">Muy lenta</option>
                                        <option value="0.7">Lenta</option>
                                        <option value="0.9" selected>Normal</option>
                                        <option value="1.1">R√°pida</option>
                                        <option value="1.3">Muy r√°pida</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Tono de voz</label>
                                    <select id="audio-pitch" class="form-control">
                                        <option value="0.5">Muy grave</option>
                                        <option value="0.8">Grave</option>
                                        <option value="1.0" selected>Normal</option>
                                        <option value="1.2">Agudo</option>
                                        <option value="1.5">Muy agudo</option>
                                    </select>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="guardarConfigAudio()">Guardar Configuraci√≥n</button>
                        </div>

                        <div class="config-section">
                            <h4>üìÖ Configuraci√≥n de Horarios</h4>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Hora de inicio</label>
                                    <input type="time" id="hora-inicio" value="08:00" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Hora de fin</label>
                                    <input type="time" id="hora-fin" value="17:00" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Intervalo entre turnos (minutos)</label>
                                    <input type="number" id="intervalo-turnos" value="30" min="15" max="60" class="form-control">
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="guardarConfigHorarios()">Guardar Horarios</button>
                        </div>
                    </div>
                </div>

                <!-- Tab: Reportes -->
                <div id="tab-reportes" class="tab-content">
                    <div class="section-header">
                        <h3>üìä Reportes y Estad√≠sticas</h3>
                        <div class="filters-container">
                            <select id="filter-mes" class="form-control">
                                <option value="">Todos los meses</option>
                                <option value="01">Enero</option>
                                <option value="02">Febrero</option>
                                <option value="03">Marzo</option>
                                <option value="04">Abril</option>
                                <option value="05">Mayo</option>
                                <option value="06">Junio</option>
                                <option value="07">Julio</option>
                                <option value="08">Agosto</option>
                                <option value="09">Septiembre</option>
                                <option value="10">Octubre</option>
                                <option value="11">Noviembre</option>
                                <option value="12">Diciembre</option>
                            </select>
                            <select id="filter-especialidad" class="form-control">
                                <option value="">Todas las especialidades</option>
                            </select>
                            <select id="filter-medico" class="form-control">
                                <option value="">Todos los m√©dicos</option>
                            </select>
                            <button class="btn btn-primary" onclick="aplicarFiltrosReportes()">üîç Aplicar Filtros</button>
                            <button class="btn btn-secondary" onclick="limpiarFiltrosReportes()">üßπ Limpiar</button>
                        </div>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë®‚Äç‚öïÔ∏è</div>
                            <div class="stat-content">
                                <div class="stat-value" id="total-medicos">0</div>
                                <div class="stat-label">M√©dicos Activos</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìã</div>
                            <div class="stat-content">
                                <div class="stat-value" id="total-turnos">0</div>
                                <div class="stat-label">Total Turnos</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è≥</div>
                            <div class="stat-content">
                                <div class="stat-value" id="turnos-pendientes">0</div>
                                <div class="stat-label">Pendientes</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚úÖ</div>
                            <div class="stat-content">
                                <div class="stat-value" id="turnos-atendidos">0</div>
                                <div class="stat-label">Atendidos</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ùå</div>
                            <div class="stat-content">
                                <div class="stat-value" id="turnos-ausentes">0</div>
                                <div class="stat-label">Ausentes</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üîî</div>
                            <div class="stat-content">
                                <div class="stat-value" id="total-llamados">0</div>
                                <div class="stat-label">Total Llamados</div>
                            </div>
                        </div>
                    </div>

                    <div class="report-details">
                        <h4>üìà Detalles por Especialidad</h4>
                        <div id="especialidades-chart" class="chart-container">
                            <div class="loading">Cargando datos...</div>
                        </div>
                    </div>

                    <div class="report-actions">
                        <button class="btn btn-primary" onclick="generarReporteDiario()">üìÑ Reporte Diario</button>
                        <button class="btn btn-success" onclick="generarReporteMensual()">üìä Reporte Mensual</button>
                        <button class="btn btn-info" onclick="generarReporteEspecialidad()">üè• Reporte por Especialidad</button>
                        <button class="btn btn-warning" onclick="exportarDatos()">üíæ Exportar Datos</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal para Nuevo/Editar M√©dico -->
        <div id="medico-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Nuevo M√©dico</h3>
                    <button class="close-btn" onclick="cerrarModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="medico-form">
                        <input type="hidden" id="medico-id">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Usuario *</label>
                                <input type="text" id="medico-username" required>
                            </div>
                            <div class="form-group">
                                <label>Contrase√±a *</label>
                                <input type="password" id="medico-password" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Nombre Completo *</label>
                            <input type="text" id="medico-nombre" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Consultorio *</label>
                                <input type="text" id="medico-consultorio" required>
                            </div>
                            <div class="form-group">
                                <label>Especialidad</label>
                                <input type="text" id="medico-especialidad">
                            </div>
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                            <button type="submit" class="btn btn-success">Guardar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="/js/sistema.js"></script>
</body>
</html>
